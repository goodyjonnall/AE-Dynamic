// Import COMMON HTML PIECES#include "assets/html.jsx";// DEFINE OBJECTSvar headerContent = "x";var plugin = {    validation: {        preliminary: {            allowContinue: false,            notifications: {                start: "pleaseLocateXMLFile.jpg",                error: "errorLoadingXML.jpg",                done: "allDone.jpg"            }        }    },    locations: {        script: (new File($.fileName)).parent    },    importData: {        path: {},        temp: {},        processed: {},            },    outputData: {        path: {},        fileName: {},        newFile: {},        htmlContent:{},        numStories:{}    }};// IMPORT SCRIPT UIfunction userInterface(){    // USER INTERFACE    scriptControl = new Window ("palette", "O2 Christmas Script");    scriptControl.graphics.backgroundColor = scriptControl.graphics.newBrush (scriptControl.graphics.BrushType.SOLID_COLOR, [0.9375,0.9375,0.9375]); // BACKGROUND COLOUR    scriptControl.margins = [20,20,20,20]; // BOX MARGINS        var imageFolder = plugin.locations.script + "/assets/";        var header = scriptControl.add ("image", undefined, File (imageFolder + "header.jpg"));                            var UI_Info = scriptControl.add("panel", undefined, "Details")                var UI_Notifications = UI_Info.add("group", undefined, "Layout")                    UI_Notifications.orientation = "row";                    UI_Notifications.margins = [20,30,20,10];                    var UI_NotificationsImage = UI_Notifications.add ("image", undefined, File (imageFolder + "validation"+"/" + plugin.validation.preliminary.notifications.start));            var UI_Phones = UI_Info.add("group", undefined, "Layout")                 UI_Phones.orientation = "row";                 UI_Phones.margins = [20,20,20,10];                    var UI_PhonesNumber = UI_Phones.add ("statictext", [0,0,77,20], "Export Name");                    var UI_PhonesNumberInput = UI_Phones.add ("edittext", [0,0,277,20], "curious_0XX_v1.html");            var scriptControlXML = UI_Info.add("group");            var scriptControlXMLButton = scriptControlXML.add ("button", [0,0,365,20], "Import XML");                scriptControlXMLButton.onClick = function() {                    try {                        plugin.importData.path = File.openDialog("Choose the file containing your button bar defaults", "XML:*.xml", false);                        plugin.outputData.path = (plugin.importData.path.path).toString();                                            plugin.importData.path.open('r');                            plugin.importData.temp = plugin.importData.path.read();                            plugin.importData.processed = new XML(plugin.importData.temp);                        plugin.importData.path.close();                                                plugin.validation.preliminary.allowContinue = true;                        UI_NotificationsImage.image = ("image", undefined, File (imageFolder + "validation"+"/" + plugin.validation.preliminary.notifications.done));                        plugin.outputData.fileName = UI_PhonesNumberInput.text;                                            } catch (err) {                        plugin.validation.preliminary.allowContinue = false;                        UI_NotificationsImage.image = ("image", undefined, File (imageFolder + "validation"+"/" + plugin.validation.preliminary.notifications.error));                    }                                    };                        var scriptControlRunScript = UI_Info.add("group");            var scriptControlRunScriptButton = scriptControlRunScript.add ("button", [0,0,365,20], "Run Script");            scriptControlRunScript.margins = [00,00,00,30];            scriptControlRunScriptButton.onClick = function() {                scriptControl.close();                 compileHTML();                            }                            scriptControl.show (); }function compileHTML(){    //CREATES NEW HTML FILE - BLANK    newFile = plugin.outputData.path + "/" + plugin.outputData.fileName;    var newHTML = new File(newFile);        newHTML.open('w');        newHTML.write("");    newHTML.close();            // COMPLIES HEADER    plugin.outputData.htmlContent = html.head.toString();    plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.header.start.toString());    plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(plugin.importData.processed.header[0]);    plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.header.end.toString());        plugin.outputData.numStories = plugin.importData.processed.body[0].elements().length()        var left = true;    for (i = 0; i <= (plugin.outputData.numStories - 1); i++) {                if (left == true) {            left = false;            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.story.left.chunkA.toString());            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(plugin.importData.processed.body[0].story[i].date[0]);            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.story.left.chunkB.toString());            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(plugin.importData.processed.body[0].story[i].hyperlink[0]);            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.story.left.chunkC.toString());            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(plugin.importData.processed.body[0].story[i].title[0]);            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.story.left.chunkD.toString());            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(plugin.importData.processed.body[0].story[i].post[0]);            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.story.left.chunkE.toString());            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(plugin.importData.processed.body[0].story[i].postedBy[0]);            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.story.left.chunkF.toString());            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(plugin.importData.processed.body[0].story[i].hyperlink[0]);            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.story.left.chunkG.toString());            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(plugin.importData.processed.body[0].story[i].imageLink[0]);            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.story.left.chunkH.toString());            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(plugin.importData.processed.body[0].story[i].imageAlt[0]);            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.story.left.chunkI.toString());                        left = false;                    } else {            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.story.right.chunkA.toString());            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(plugin.importData.processed.body[0].story[i].hyperlink[0]);            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.story.right.chunkB.toString());            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(plugin.importData.processed.body[0].story[i].imageLink[0]);            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.story.right.chunkC.toString());            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(plugin.importData.processed.body[0].story[i].imageAlt[0]);            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.story.right.chunkD.toString());            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(plugin.importData.processed.body[0].story[i].date[0]);            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.story.right.chunkE.toString());            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(plugin.importData.processed.body[0].story[i].hyperlink[0]);            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.story.right.chunkF.toString());            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(plugin.importData.processed.body[0].story[i].title[0]);            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.story.right.chunkG.toString());            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(plugin.importData.processed.body[0].story[i].post[0]);            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.story.right.chunkH.toString());            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(plugin.importData.processed.body[0].story[i].postedBy[0]);            plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.story.right.chunkI.toString());            left = true;        };            };    plugin.outputData.htmlContent = plugin.outputData.htmlContent.concat(html.footer.toString());    plugin.outputData.htmlContent = plugin.outputData.htmlContent.replace(/(\r\n|\n|\r|\t)/gm,"");    plugin.outputData.htmlContent = plugin.outputData.htmlContent.replace(/\s+/g," ");                newHTML.open('w');        newHTML.write(plugin.outputData.htmlContent);    newHTML.close();}// STARTfunction runOperations() {    userInterface();    }runOperations();